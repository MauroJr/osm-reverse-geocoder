#!/usr/bin/perl

use DBI;
use strict;

sub main {
	my $dbh = DBI->connect(undef, undef, undef) || die $DBI::errstr;
	my $sth = $dbh->prepare("SELECT * FROM reverse_geocode(?, ?)");
	my $start = time();
	while (<DATA>) {
		chomp;
		my($latitude, $longitude) = split /\t/;
		$sth->execute($latitude, $longitude) || die $DBI::errstr;
		my $res = $sth->fetchrow_hashref();
		printf "%s,%s,%s;%s;%s;%s;%s\n", $latitude, $longitude, $res->{"country_iso"}, $res->{"city"}, $res->{"street"}, $res->{"housenumber"}, $res->{"distance"};
	}
	my $end = time();
	printf "took %d seconds to process 500 coordinates, %.2f sec/coordinate\n", ($end - $start), ($end - $start) / 500;
	$sth->finish();
	$dbh->disconnect();
}

main();

__DATA__
49.544683	18.902313
44.419700	9.169720
46.953490	14.959646
53.961019	26.202877
47.036632	5.066200
44.113268	24.499960
49.048761	2.337188
51.627897	8.375846
47.273228	39.732104
44.505265	7.810092
56.307204	35.095545
49.714619	14.621363
48.792886	14.789001
53.333903	10.400127
44.358491	40.517167
44.306452	23.843804
56.328702	21.084643
46.542781	5.539109
51.827893	4.166600
61.060386	28.096315
38.864333	-4.379128
42.285555	9.118381
50.848318	12.091112
50.852771	12.463226
58.810416	26.400113
47.892233	2.526815
50.115068	35.600673
48.521596	8.223789
39.855235	37.384061
64.272722	27.777053
45.839144	23.900365
47.746065	18.503784
55.882415	12.995961
44.695603	7.857619
50.230498	24.130731
55.473730	22.691909
43.977860	-0.644160
47.369771	8.696884
53.293969	8.222639
60.929161	24.371049
45.614353	5.912131
48.028516	31.969099
48.333266	11.299042
44.032890	10.618875
43.913571	1.750042
46.252577	2.868955
52.452421	12.934634
42.198999	-4.707235
46.414637	28.017550
50.847487	9.455814
63.874937	24.311465
51.071832	16.464084
43.547145	16.340929
44.977768	15.014986
41.182886	14.344120
45.471549	4.841514
57.157219	9.544968
58.875834	5.743377
60.867717	22.283489
54.489089	33.439772
41.895560	-6.147177
60.856879	26.683462
60.988434	25.500250
62.388269	25.637730
55.818975	13.018105
51.577459	-2.990480
50.609466	25.517609
51.594785	0.503527
37.703268	-5.028848
46.367582	2.483377
43.146329	-9.172857
43.589684	-0.324165
44.943093	10.377388
50.818346	1.742009
54.430755	25.211212
49.454784	9.343384
52.035060	23.559155
48.024424	19.148061
56.499410	24.055792
51.560243	19.950730
38.035440	-7.896965
46.551689	25.771997
44.570139	6.093735
49.735251	2.860145
48.186326	0.928235
47.758271	22.870226
51.262747	12.025617
45.747414	5.600041
51.871286	16.050538
39.211180	33.063145
45.400822	8.610828
55.894086	38.480416
54.619499	-1.756847
43.660282	23.064904
41.859286	8.928730
48.834259	1.894937
50.804386	36.018132
55.400399	43.499029
49.854789	3.907976
47.148947	18.071776
52.319980	-2.151510
46.158858	18.574817
41.653321	26.734809
46.817343	28.765827
49.129939	11.114287
51.415830	12.564528
55.557919	10.179442
46.621667	11.028444
41.936369	44.117832
63.024159	14.078402
41.124448	27.484844
48.962412	-0.890789
59.238989	14.993079
50.972051	19.364923
48.145038	16.921748
63.578888	28.537379
55.249748	10.258348
50.883132	35.545885
38.514966	39.045236
52.671873	9.105730
44.981065	23.681767
40.646906	-3.969832
46.706456	12.634928
51.634382	10.293561
51.174203	35.139793
44.097499	5.011321
53.884821	30.229260
66.493473	22.088294
39.500970	3.010698
45.333964	5.816404
63.969177	25.051163
55.351487	36.755124
45.828467	8.673871
41.259265	-6.394329
47.666410	4.245205
54.984756	21.573719
50.299345	14.077620
53.318668	14.212719
60.546488	24.745483
52.362634	4.796218
50.652630	4.284579
48.369293	4.789546
49.885852	20.100106
48.970178	8.761840
46.295680	20.110944
46.378670	19.445332
52.165285	-7.749985
54.460145	25.275659
39.968011	-3.886932
42.441471	1.437899
46.039244	13.109162
48.431994	10.441909
43.402147	6.340358
42.635404	13.873487
49.511945	7.088293
45.522186	-0.859378
58.837527	14.738781
36.596216	-5.786080
43.118678	44.320230
47.860261	5.799830
56.470287	9.797488
41.541259	1.900260
58.658587	26.507215
54.529471	43.964679
54.099267	43.240896
52.174664	7.534445
51.315181	6.494231
47.216264	14.435896
47.777732	9.593316
44.471118	6.295839
51.406287	23.817045
59.264719	9.934921
39.841438	-2.997895
61.130643	38.720192
52.415543	32.381692
51.603998	-1.235585
45.299620	1.868225
48.782955	16.986418
51.214588	29.485264
43.512980	5.654527
47.915902	13.577133
44.332162	1.389192
51.155071	17.760103
56.294905	13.078422
45.456473	6.102999
56.547539	10.375982
40.970885	26.846740
55.730809	8.596820
37.623789	-6.604345
53.932574	27.880128
47.633502	6.078957
51.985716	7.279706
47.251541	15.717901
65.644804	25.931964
44.798070	8.246777
45.237981	19.691460
58.626528	35.369493
57.591006	34.537804
52.619525	12.005238
51.742578	8.622117
58.559447	6.689390
43.308086	18.853096
47.681645	11.777349
42.191650	-8.072732
53.448213	7.376270
51.728132	32.488051
53.481252	14.559701
49.566684	9.677812
50.882002	4.227536
56.166931	-4.065080
50.321281	1.605250
64.093158	15.881637
47.066124	8.583615
43.138212	19.297778
66.683972	27.288298
39.873842	33.646939
52.781713	9.273825
60.767359	6.485236
46.069619	12.590441
46.878404	-1.706621
61.421210	10.359447
40.707183	31.561014
39.839398	-6.401062
49.559036	-1.658477
47.995073	17.682263
46.731443	-1.836611
50.783385	7.396909
45.968858	0.202371
47.744533	15.626807
50.939882	0.756105
60.220391	23.368958
49.352670	20.797906
50.689663	34.066045
60.004961	18.615384
40.076620	27.698125
47.596801	28.827580
51.906336	15.520733
51.428082	0.010613
52.342709	17.660722
44.017643	7.442254
43.307473	-0.588841
47.163220	10.203887
51.762246	21.787564
48.408502	1.522860
54.753642	11.193455
41.674899	13.256374
52.255690	11.869026
48.945866	7.714139
43.047332	26.223571
50.626516	5.707536
47.410896	4.645990
50.032284	2.710041
47.779321	40.412716
45.769981	5.909767
47.277886	0.829924
54.163870	15.511511
47.595903	12.322616
46.787811	33.160709
61.827026	44.829222
44.333963	23.119268
58.113197	11.726839
43.844328	2.134955
48.224485	0.747315
54.581167	30.628330
38.271674	23.577846
48.764802	25.618276
52.918810	-2.920583
49.829555	13.409910
44.909761	20.892640
49.185095	8.828732
52.427803	14.995778
67.925659	15.563988
51.109683	17.098614
43.048466	-7.524695
39.915722	41.196017
44.208971	43.159249
49.714553	17.128337
39.413514	-6.414664
43.418107	1.135799
48.890371	31.771401
41.854265	13.582504
42.200965	20.442555
38.007927	-3.488312
54.242889	10.153099
47.668339	7.069812
58.531613	16.024868
51.540027	-0.104217
39.453656	-2.146090
55.111712	9.352517
52.412317	6.340953
50.534073	28.532948
40.057866	8.643227
53.207716	6.092711
42.180419	-0.245568
58.397218	24.411329
36.740424	-4.006135
57.974039	37.114136
43.906584	5.112696
45.880728	1.752646
45.176051	16.836548
50.003396	18.864598
48.427439	6.378418
45.378706	8.919684
57.050458	43.927120
47.088917	18.855702
50.941590	9.775315
50.366895	-4.122397
46.087714	3.358949
46.461906	3.366693
47.592261	8.082111
47.244506	22.402776
52.039030	13.733366
36.694369	37.289660
50.511641	12.611204
48.224594	15.564261
45.581871	19.639864
48.077215	0.328509
45.556598	-0.482450
41.986228	21.087711
42.707809	2.455211
62.352459	22.798197
59.369197	11.161377
44.700700	3.637373
50.009691	2.000410
49.347646	13.930416
45.452390	38.662824
49.459204	2.990005
62.646208	8.113612
42.588350	-8.589042
42.616814	11.668120
47.065079	18.892778
45.360035	4.643140
62.264157	8.216136
45.823650	12.418346
46.343692	-0.144131
51.391565	14.283461
46.944146	5.655656
37.800365	-3.974011
62.544848	22.563809
54.083043	12.467361
45.653057	9.919561
38.432526	-7.724738
50.049058	15.049910
46.713280	28.780826
38.595086	23.851817
56.063911	12.489121
47.105228	32.811145
39.101928	42.629120
47.240619	12.082389
56.774365	9.081099
54.941317	9.289670
59.423083	29.751867
44.476796	7.574670
45.705996	16.046269
48.336193	-1.863836
45.319534	41.104185
48.740781	1.962323
49.283750	17.757050
39.678127	37.461113
42.151332	21.096313
39.980527	-6.322672
52.451956	7.849509
54.576240	-1.706522
51.483039	8.606963
44.505885	11.126179
53.208598	8.842119
49.193020	22.308609
51.560243	7.399922
51.065383	4.353154
58.425417	29.394538
40.495139	-8.520581
48.566332	5.458257
53.301566	27.181715
53.579387	13.268827
51.566710	3.579259
44.773462	38.799514
58.837415	11.983554
55.889206	12.195233
51.701932	5.221272
51.107341	10.645428
46.894213	6.412294
47.265338	6.892349
51.691591	33.484785
59.376918	24.309260
39.448884	44.011856
49.208851	21.437054
56.433460	13.857315
43.822259	4.733237
47.701006	16.005427
47.529421	6.369431
48.383371	4.269851
46.230521	7.012153
50.698417	4.471400
36.992454	-3.154135
49.231003	12.299362
56.814544	25.812349
53.148716	-1.643798
61.538787	9.687819
51.304599	8.131012
47.040099	8.216762
61.384729	35.336213
45.543011	10.557342
47.182477	19.349728
46.315795	27.569739
46.673567	30.873693
44.230447	28.170630
54.761528	27.089420
43.310959	5.382336
47.837837	9.357062
48.173045	12.625559
38.396132	-1.997427
41.745996	44.279220
47.722400	7.618883
49.673313	14.497515
62.148639	23.668163
48.712103	43.503410
48.949492	44.846352
47.699781	12.110725
52.781443	13.199212
48.205810	3.621605
42.953073	-7.156373
42.965820	-8.845917
46.332985	7.631413
42.991595	11.024586
62.084249	5.592764
45.894995	12.113105
41.910296	15.910999
57.009840	15.224886
51.379262	14.852333
43.935839	4.996390
43.411350	0.886660
55.532570	42.089484
55.933180	-4.403624
61.499229	24.551253
60.639263	5.113635
53.819790	32.437143
47.991072	-0.154363
50.544243	-4.668209
46.047928	1.192227
52.305748	9.474514
50.265850	18.714878
50.597599	12.668918
60.338713	5.197218
53.193282	6.112915
48.787344	-3.436098
47.987596	16.306808
47.219851	7.623452
37.469834	-5.565023
52.328252	-0.509783
51.236204	-2.384732
51.128629	5.942355
47.046456	1.568850
45.795245	15.726110
49.081887	7.682089
43.152242	-0.532108
51.566029	12.603464
58.437305	24.508200
59.532908	8.114712
49.083622	19.594641
66.198452	21.491493
40.897271	0.377127
55.637995	23.913182
48.448649	-4.161321
57.956757	36.493221
48.875755	-1.190968
46.660058	25.587052
62.473402	21.206188
45.086028	21.293864
54.307970	26.403993
51.720519	-4.270839
50.804358	-1.169286
51.427734	0.197641
51.796667	5.062408
50.049579	25.044752
41.210518	16.157770
40.384930	15.121236
37.763878	15.149398
43.745316	15.891621
50.755125	37.354827
52.963067	13.883696
41.694492	2.484464
53.610836	24.960446
50.410715	18.945981
66.067050	16.079754
53.388928	-1.349452
40.398484	-8.587041
44.029421	1.363354
45.684103	12.237802
50.970601	7.300361
52.377735	0.078551
52.937340	5.029671
40.409810	-3.694352
58.544693	13.025238
47.711219	33.791337
55.381992	11.984421
59.119683	31.703485
53.515403	8.834617
47.986295	15.233116
49.231425	8.528828
38.774341	16.236379
